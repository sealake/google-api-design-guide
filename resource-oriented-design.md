# 面向资源的设计

本设计指南的目的是帮助开发者设计出简单、一致和易于使用的网络 API，同时它也帮助我们统一了 RPC API（基于 socket）与 REST API（基于 HTTP）的设计。

传统上，人们根据既有的如`CORBA`和`Windows COM`的API接口和方法来设计`RPC API`。随着时间推移，越来越多的接口和方法被引入。最终的结果可能是被大量的接口和方法淹没，每个接口和方法与其他方法不同。开发人员为了正确使用接口必须仔细学习，既耗时又容易出错。

REST的架构风格于2000年首次推出，主要用于与HTTP/1.1配合使用。其核心原则是定义可以使用少量方法进行操作的命名资源。 `资源`和`方法`被称为API的名词和动词 。使用HTTP协议，资源名称自然地映射为URL，方法自然地映射到HTTP方法`POST`， `GET`，`PUT`，`PATCH`和`DELETE`。

在互联网上，HTTP REST API最近取得了巨大的成功。在2010年，大约74％的公共网络API是HTTP REST API。

虽然HTTP REST API在互联网上非常受欢迎，但它们传输的数据量比传统的RPC API小。 例如，美国高峰时段的互联网流量的大约一半是视频内容，是因为效率问题，很少有人会考虑使用REST API来传输这些内容。在数据中心内部，许多公司使用基于 socket 的 RPC API 来承载大多数网络流量，这会比REST API高出几个数量级。

实际上，由于种种原因，RPC API和HTTP REST API都是需要的。理想情况下，API平台应为所有API提供最佳支持。 本设计指南可帮助您设计和构建符合这一原则的API。 它通过将资源导向的设计原理应用于通用API设计来实现，并且定义了许多常见的设计模式以提高可用性并降低复杂性。

> 注意： 本设计指南阐释如何将REST原理应用于独立于编程语言，操作系统或网络协议的API设计。它不仅仅是创建REST API的指南。

## 什么是 REST API？

REST API被建模为可单独寻址的资源（API的名词 ）的集合。资源通过它们的`资源名称`引用，并通过一小组方法（也称为动词或操作）进行操作 。

`REST Google API`（也称为REST方法 ）的标准方法是`List`，`Get`， `Create`，`Update`和`Delete`。当存在类似数据库事务这种不能被简单地映射到标准方法的需求时，API 设计者也可以使用自定义方法（也叫自定义动词或自定义操作）。

> 注意 ：自定义动词并不意味着创建自定义HTTP动词以支持自定义方法。 对于基于HTTP的API，它们只是映射到最合适的HTTP动词。

## 设计流程

本设计指南建议采取以下步骤设计面向资源的API（具体部分将在后续章节详细介绍）：

+ 确定API提供的资源类型
+ 确定资源之间的关系
+ 根据类型和关系确定资源名称方案
+ 确定资源的模式
+ 为资源添加最小的方法集

## 资源

面向资源的API通常被建模为资源层次结构，其中每个节点都是简单资源或集合资源 。 为了方便起见，它们通常被称为资源和集合。

+ 集合包含相同类型的资源列表。例如，用户具有联系人的集合。
+ 资源有一些状态以及零个或多个子资源。每个子资源可以是简单资源或资源集合。

例如，Gmail API拥有一组用户，每个用户都有一组消息，一组线程，一组标签，一个配置文件资源以及一些设置项资源。

虽然存储系统和REST API之间存在一些概念上的一致性，但面向资源的API的服务并不一定是数据库，在解释资源和方法方面具有很大的灵活性。 例如，创建日历事件（资源）可能会为与会者创建附加事件，向与会者发送电子邮件邀请，预留会议室和更新视频会议时间表。

## 方法

面向资源的API的关键特征是它通过对资源执行的方法（功能）来强调资源（数据模型）。典型的面向资源的API使用少量方法来暴露大量资源。这些方法可以是标准方法或自定义方法。 对于本指南，标准方法是：`List`，`Get`，`Create`，`Update`和`Delete`。

API功能自然地映射到一个标准方法时， `应该（SHOULD）`在API设计中使用该方法。对于不能自然地映射到标准方法的功能，`可以(MAY)`使用自定义方法。自定义方法提供与传统RPC API相同的设计自由度，可用于实现常见的编程模式，如数据库事务或数据分析。

## 例子

以下部分介绍了如何将面向资源的API设计应用于现实世界的大规模服务。

### Gmail API

`Gmail API服务`实现了`Gmail API`，并提供了大部分的Gmail功能。 它具有以下资源模型：

+ Gmail API服务： `gmail.googleapis.com`
+ 用户集合： `users/*`。 每个用户具有以下资源。
    - 消息集合： `users/*/messages/*`
    - 线程集合： `users/*/threads/*`
    - 标签的集合： `users/*/labels/*`
    - 更改历史的集合： `users/*/history/*`
    - 代表用户配置文件的资源： `users/*/profile`
    - 表示用户设置的资源： `users/*/settings`

## Google Cloud Pub / Sub API

`pubsub.googleapis.com`服务实现了`Google Cloud Pub/Sub API`，它定义了以下资源模型：

+ API服务： pubsub.googleapis.com
+ 主题集： projects/*/topics/* 。
+ 订阅的集合： projects/*/subscriptions/* 。

> Pub/Sub API的其他实现可以选择不同的资源命名方案。
